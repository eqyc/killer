# 0001. 选择 Rust 作为主开发语言

- **状态**: 已接受
- **决策者**: 架构组、技术委员会
- **日期**: 2024-01-05
- **技术故事**: KILLER-10

## 背景与问题陈述

KILLER ERP 系统需要处理企业核心业务流程，包括财务核算、供应链管理、生产制造等关键业务。这些业务对系统的性能、可靠性和安全性有极高要求。

系统预期承载的负载包括：百万级的并发业务处理能力、亚毫秒级的交易响应时间、99.99% 的可用性目标。同时，作为企业核心系统，任何内存安全漏洞或运行时崩溃都可能导致严重的业务损失。

我们需要选择一种能够同时满足高性能、高可靠性和高安全性要求的主开发语言。

## 决策驱动因素

- **性能**: 需要极低的延迟和高吞吐量
- **可靠性**: 生产环境零崩溃容忍
- **内存安全**: 避免常见的安全漏洞
- **并发能力**: 高效处理大量并发请求
- **生态系统**: 需要成熟的 Web 框架和数据库驱动
- **招聘与培训**: 需要考虑人才市场情况

## 考虑的方案

### 方案 1: Go

Go 是 Google 开发的系统编程语言，以简洁和高效的并发模型著称，在云原生领域广泛应用。

**优点**:
- 简洁的语法，学习曲线平缓
- 优秀的并发模型（goroutine）
- 编译速度快
- 云原生生态成熟（Kubernetes、Docker 都用 Go 编写）
- 人才市场相对充裕

**缺点**:
- GC 暂停可能影响低延迟场景
- 泛型支持较晚（Go 1.18），生态适配中
- 错误处理冗长（if err != nil）
- 没有编译期内存安全保证

### 方案 2: Rust

Rust 是 Mozilla 开发的系统编程语言，专注于安全性、并发性和性能，通过所有权系统在编译期保证内存安全。

**优点**:
- 编译期内存安全保证，无 GC 暂停
- 零成本抽象，性能接近 C/C++
- 强大的类型系统和模式匹配
- async/await 原生支持
- Cargo 包管理器体验优秀

**缺点**:
- 学习曲线陡峭（所有权、生命周期）
- 编译时间较长
- 人才市场相对稀缺
- 生态系统不如 Go/Java 成熟

### 方案 3: Java (Spring Boot)

Java 是企业应用开发的传统选择，Spring Boot 提供了成熟的微服务框架。

**优点**:
- 企业级生态最成熟
- 人才市场充裕
- 丰富的第三方库和工具
- JIT 优化后性能可观

**缺点**:
- JVM 预热时间长
- 内存占用较高
- GC 暂停影响低延迟场景
- 冷启动慢，不利于弹性扩缩容

## 决策结果

**选择方案**: 方案 2 - Rust

**理由**:

ERP 系统对性能和可靠性的极高要求是选择 Rust 的首要原因。Rust 的零成本抽象意味着我们可以在不牺牲性能的前提下编写高层次的抽象代码。没有 GC 暂停确保了系统能够提供稳定的低延迟响应。

Rust 的所有权系统在编译期捕获内存安全问题，从根本上消除了空指针、数据竞争、使用释放后内存等常见漏洞。对于处理财务数据的核心系统，这种安全保证至关重要。

虽然 Rust 的学习曲线较陡，但我们认为这是值得的投资。团队一旦掌握 Rust，代码质量和系统可靠性都会显著提升。对于人才稀缺的问题，我们计划通过内部培训和有竞争力的薪酬来解决。

## 积极后果

- 系统性能可达到接近 C/C++ 的水平
- 编译期消除大部分内存安全漏洞
- 无 GC 暂停带来稳定的低延迟
- 团队技术能力提升
- 形成技术差异化优势

## 消极后果

- 前期培训成本较高
- 招聘难度增加
- 编译时间较长，影响开发效率
- 部分第三方库可能不如其他语言成熟

## 遵从性

- 所有后端服务必须使用 Rust 开发
- 建立内部 Rust 培训体系
- 使用 clippy 和 rustfmt 保证代码质量
- CI 必须通过所有安全性检查

## 相关链接

- [Rust 官方网站](https://www.rust-lang.org/)
- [Tokio 异步运行时](https://tokio.rs/)
- [Axum Web 框架](https://github.com/tokio-rs/axum)

---

## 修订历史

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| 2024-01-05 | 1.0 | 初始版本 | 架构组 |
