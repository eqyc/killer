# 0000. 使用架构决策记录

- **状态**: 已接受
- **决策者**: 架构组
- **日期**: 2024-01-01
- **技术故事**: KILLER-1

## 背景与问题陈述

KILLER ERP 是一个大型企业级系统，涉及多个业务域、众多技术选型和复杂的架构设计。随着项目的推进，我们面临以下挑战：

首先，团队成员对于"为什么这样设计"的问题缺乏统一的信息来源。新加入的成员需要花费大量时间询问老成员才能理解架构决策的背景。其次，一些重要的技术决策仅存在于会议记录或即时通讯工具中，难以检索和回顾。

我们需要一种系统化的方式来记录、追踪和传承架构决策，确保团队对技术选型和设计模式有共同的理解。

## 决策驱动因素

- 需要为新成员提供架构学习资料
- 需要记录决策的背景和理由以便未来回顾
- 需要避免已讨论过的问题被反复提出
- 需要轻量级、易于维护的文档形式
- 文档应与代码一起版本控制

## 考虑的方案

### 方案 1: 使用 Wiki 记录决策

使用 Confluence 或 GitLab Wiki 等工具记录架构决策，以富文本形式组织内容。

**优点**:
- 富文本编辑，支持复杂格式
- 可以嵌入图片、附件
- 支持评论和协作

**缺点**:
- 与代码库分离，容易过时
- 版本历史不如 Git 清晰
- 搜索和关联性较弱

### 方案 2: 使用 ADR (Markdown 格式)

在代码仓库中使用 Markdown 文件记录架构决策，遵循 MADR（Markdown ADR）格式规范。

**优点**:
- 与代码一起版本控制
- 通过 Pull Request 进行评审
- 轻量级，易于编写和维护
- 支持 Git 的完整历史追踪

**缺点**:
- 格式相对简单
- 需要团队学习 Markdown 语法
- 图表需要使用 Mermaid 或外部工具

### 方案 3: 使用专用架构工具

使用 Structurizr、Archi 等专业架构工具记录决策。

**优点**:
- 专业的架构建模能力
- 可生成多种视图和报告
- 支持架构元素关联

**缺点**:
- 学习曲线陡峭
- 可能需要付费许可
- 与开发流程集成度较低

## 决策结果

**选择方案**: 方案 2 - 使用 ADR (Markdown 格式)

**理由**:

ADR 方式最符合我们的需求。将决策记录与代码放在同一仓库中，确保两者保持同步，避免文档与实现脱节。通过 Pull Request 流程，架构决策可以得到团队的充分讨论和评审。

Markdown 格式简单易学，所有开发人员都能快速上手。MADR 模板提供了清晰的结构，确保每个决策记录都包含必要的背景、方案分析和理由说明。

此外，Git 的版本历史能够完整追踪决策的演变过程，便于理解决策是如何随时间变化的。

## 积极后果

- 所有架构决策有统一的记录位置
- 新成员可以通过阅读 ADR 快速了解架构背景
- 决策过程透明，可追溯
- 避免已讨论问题的重复争论

## 消极后果

- 需要花时间编写和维护 ADR
- 团队成员需要养成记录决策的习惯
- 早期的一些决策需要补充记录

## 遵从性

- 重要的架构决策必须先创建 ADR 提案
- ADR 需要通过 Pull Request 评审后才能合并
- 定期回顾 ADR 索引，确保内容完整

## 相关链接

- [MADR - Markdown ADR](https://adr.github.io/madr/)
- [Documenting Architecture Decisions - Michael Nygard](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)

---

## 修订历史

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| 2024-01-01 | 1.0 | 初始版本 | 架构组 |
