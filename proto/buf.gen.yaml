# =============================================================================
# Buf 代码生成配置
# https://buf.build/docs/configuration/v2/buf-gen-yaml
# =============================================================================

version: v2

# 清理输出目录
clean: true

# 托管模式 - 自动管理依赖的代码生成
managed:
  enabled: true
  override:
    - file_option: go_package_prefix
      value: github.com/killer-erp/killer/gen/go

# 插件配置
plugins:
  # ==========================================================================
  # Rust 代码生成 (Tonic + Prost)
  # ==========================================================================

  # Prost - Protocol Buffers 消息类型生成
  - local: protoc-gen-prost
    out: ../libs/integration/api-contracts/src/gen
    opt:
      - compile_well_known_types
      - extern_path=.google.protobuf=::prost_types
      - file_descriptor_set

  # Prost Serde - 添加 Serde 支持
  - local: protoc-gen-prost-serde
    out: ../libs/integration/api-contracts/src/gen

  # Tonic - gRPC 服务代码生成
  - local: protoc-gen-tonic
    out: ../libs/integration/api-contracts/src/gen
    opt:
      - compile_well_known_types
      - extern_path=.google.protobuf=::prost_types

  # ==========================================================================
  # Go 代码生成 (可选，用于其他语言客户端)
  # ==========================================================================

  # - remote: buf.build/protocolbuffers/go
  #   out: ../gen/go
  #   opt:
  #     - paths=source_relative

  # - remote: buf.build/grpc/go
  #   out: ../gen/go
  #   opt:
  #     - paths=source_relative

  # ==========================================================================
  # TypeScript 代码生成 (可选，用于前端)
  # ==========================================================================

  # - remote: buf.build/bufbuild/es
  #   out: ../gen/ts

  # - remote: buf.build/connectrpc/es
  #   out: ../gen/ts

  # ==========================================================================
  # OpenAPI 文档生成
  # ==========================================================================

  # - remote: buf.build/grpc-ecosystem/openapiv2
  #   out: ../docs/api
  #   opt:
  #     - allow_merge=true
  #     - merge_file_name=openapi

# 输入配置
inputs:
  - directory: .

# =============================================================================
# 支持的业务域 Proto 文件
# =============================================================================
# 
# 财务域:
#   - finance/financial/v1/financial.proto    (财务会计)
#   - finance/controlling/v1/controlling.proto (管理会计)
#   - finance/treasury/v1/treasury.proto      (资金管理)
#
# 物流域:
#   - logistics/materials/v1/materials.proto  (物料管理)
#   - logistics/warehouse/v1/warehouse.proto  (仓储管理)
#   - logistics/shipping/v1/shipping.proto    (发运管理)
#
# 运营域:
#   - operations/production/v1/production.proto   (生产管理)
#   - operations/maintenance/v1/maintenance.proto (设备维护)
#   - operations/quality/v1/quality.proto         (质量管理)
#
# 采购域:
#   - procurement/purchasing/v1/purchasing.proto  (采购管理)
#   - procurement/scm/v1/scm.proto                (供应链计划)
#
# 商业域:
#   - commercial/sales/v1/sales.proto             (销售管理)
#   - commercial/crm/v1/crm.proto                 (客户关系)
#   - commercial/field-service/v1/field_service.proto (现场服务)
#
# 人力资本域:
#   - human-capital/hr/v1/hr.proto                (人事管理)
#   - human-capital/payroll/v1/payroll.proto      (薪酬管理)
#
# 项目研发域:
#   - project-rd/project/v1/project.proto         (项目管理)
#   - project-rd/plm/v1/plm.proto                 (产品生命周期)
#
# 公共服务:
#   - common/v1/types.proto                       (通用类型)
#   - common/v1/errors.proto                      (错误定义)
#   - common/v1/pagination.proto                  (分页定义)
#   - common/v1/api_gateway.proto                 (API网关)
#   - common/v1/identity.proto                    (身份认证)
#   - common/v1/master_data.proto                 (主数据管理)
